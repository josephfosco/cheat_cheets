.





   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Cheat Sheets</title>
    <link rel="icon" href="./favicon.ico">
    <link rel="stylesheet" href="./css/main.css">
  </head>
  <body class="page">
    <input class="menu-checkbox" id="menu" type="checkbox">
    <header class="header">
      <div class="header__container">
        <label class="header__menu-toggle" for="menu"><span class="hamburger"><span class="hamburger__bar"></span><span class="hamburger__bar"></span><span class="hamburger__bar"></span></span></label>
        <div class="header__logo">
            <a class="header__logo-link" href="./">Cheat Sheets</a>
        </div>
      </div>
    </header>
    <nav class="navigation">
  <div class="navigation__container">
    <label class="navigation__menu-toggle" for="menu"><span class="cross"></span></label>
    <div class="navigation__category">Navigation</div>
    <ul class="navigation__link-list">
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./airflow.html">
            airflow
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./emacs.html">
            emacs
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./git.html">
            git
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./hubot.html">
            hubot
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./i3.html">
            i3
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./linux.html">
            linux
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./msos.html">
            msos
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./platform_notes.html">
            Platform Notes
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./postgres.html">
            postgres
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./python.html">
            python
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./tmux.html">
            tmux
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./vi.html">
            vi
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./wordpress.html">
            Wordpress
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./iprospect.html">
            iProspect
          </a>
        </li>
      
    </ul>
  </div>
</nav>

    <main class="content">
      <h2 id="creating-a-shell-with-environment-vars-from-consul">Creating a Shell with environment vars from Consul</h2>
<h3 id="python">PYTHON</h3>

<p><code class="highlighter-rouge">sudo -u deploy -i
cd src/newman/current/
source &lt;(/etc/apps/config/deploy/render_config newman)
env/bin/python manage.py shell</code></p>

<p>type “exit” or ctl-d to leave the deploy shell and return to your prior user</p>

<h3 id="ruby-">RUBY ***</h3>

<p>for infosphere
there’s a script on there called <code class="highlighter-rouge">console_quickstart</code>
I believe it loads up the <code class="highlighter-rouge">bundle exec rails console</code> with some extra vars like the consul config (<em>I think</em> on this latter part)
so once you are on the server you’d do <code class="highlighter-rouge">sudo -u deploy bash /var/deploy/src/infosphere/current/console_quickstart.sh</code>
and then the interaction is the same as it would be if you were local doing <code class="highlighter-rouge">bundle exec rails console</code></p>

<h2 id="redis">Redis</h2>

<p><strong>To delete multiple keys based on a wildcard</strong></p>

<p>In the shell type something like (to delete all keys that start with “humana:*”)
<code class="highlighter-rouge">redis-cli KEYS "humana:*" | xargs redis-cli del</code></p>

<p><strong>To delete items from the redis registry</strong></p>

<p>access the redis host
<code class="highlighter-rouge">$ redis-cli -h &lt;redis host&gt; (something like redis-primary.qa.ause2)</code></p>

<p>to see if the entry you want to delete exists
<code class="highlighter-rouge">$ hget psh-registry-qa &lt;service&gt;::&lt;version&gt; (something like adtalem-auc-lead-submit::1.0)</code>
<code class="highlighter-rouge">$ hget psh-registry-production ping::1.0</code></p>

<p><em>locally</em></p>

<p><code class="highlighter-rouge">$ hget psh-registry &lt;service&gt;::&lt;version&gt; (something like adtalem-auc-lead-submit::1.0)</code></p>

<p>to delete the entry
<code class="highlighter-rouge">$ hdel psh-registry-qa &lt;service&gt;::&lt;version&gt; (something like adtalem-auc-lead-submit::1.0)</code></p>

<p><strong>to view the registry in a browser</strong>
<code class="highlighter-rouge">localhost:8000/registry/tasks</code></p>

<p><em>or in production</em>
<code class="highlighter-rouge">psh.leapfrogonline.net/registry/tasks</code></p>

<p><strong>redis memory alerts</strong></p>

<p>To run the script to expire sessions for a rogue bot ip
get the redisreporter repo https://github.com/iprospect-usa/redisreporter</p>

<p><code class="highlighter-rouge">$ env/bin/python mulderexpire.py --host redis-primary.production.ause2 --ip &lt;ip to remove e.g. 94.156.174.137&gt; --limit 10000 --expire 5</code></p>

<p><strong>To see if redis secondary was marked as the master, and how to restart redis</strong></p>

<p><code class="highlighter-rouge">redis-cli -h redis-secondary.qa.ause2</code><br />
then run the <code class="highlighter-rouge">info</code> command. 
There is a <code class="highlighter-rouge">Replication</code> section in the output that details the role the server is currently playing</p>

<p>If you have access to start/stop the redis service. It would follow the normal start/stop of an lfo daemon.
<code class="highlighter-rouge">sudo systemctl stop redis.service</code></p>

<p>wait for sentinel to</p>

<ol>
  <li>detect the instance being down and</li>
  <li>switch the server roles around</li>
</ol>

<p>then 
<code class="highlighter-rouge">sudo systemctl start redis.service</code></p>

<h2 id="artifactory">artifactory</h2>

<p>When having trouble acessing artifactory (from a make script) An error like</p>

<p><code class="highlighter-rouge">"HTTPError Could not fetch specs from https://gems.leapfrogonline.net/"</code></p>

<p>Try stopping the vpn and restarting it.</p>

<h3 id="to-deploy-a-library-to-artifactory">To Deploy a library to artifactory</h3>

<ol>
  <li>Goto artifactory.leapfrogonline.net/</li>
  <li>On the left under “Artifactory” select “Artifacts”</li>
  <li>In the upper right click “Deploy”</li>
  <li>To deploy a Python library, under “Target Repository” select “lfo-pypy”</li>
  <li>Select the library to deploy</li>
  <li>Click “Deploy” (no need to check any other options)</li>
</ol>

<h2 id="epi">epi</h2>
<p><strong>sample curl string:</strong>
<code class="highlighter-rouge">curl -X POST localhost:9707/v1/valid_zipcode/0.2.0 -H "Content-Type: application/x-www-form-urlencoded" -d api_token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code></p>

<p><code class="highlighter-rouge">curl -X POST https://qa-epi.leapfrogonline.com/v1/external_configuration/1.0 -H "Content-Type: application/x-www-form-urlencoded" -d api_token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX -d flow_id=46</code></p>

<h2 id="hashi">hashi</h2>

<p><strong>to look at events in the hashi db</strong></p>

<p>to log in</p>

<p><code class="highlighter-rouge">psql -h db1.qa.ause2 -U hashi -p 9999</code>
^^^^^^^ logs into hashi database in qa<br />
-h from consul services<br />
-U from consul hashi config postgress_username<br />
-p from consul hashi config postgress_port</p>

<p>will prompt for password get it from
consul hashi config postgres_password</p>

<p><code class="highlighter-rouge">select * from messages where topic='preview.events.geo_locate.census_features';</code></p>

<p><em>to see a the last event</em>
<code class="highlighter-rouge">select max(id) from messages;</code>
<code class="highlighter-rouge">select * from messages where id=&lt;id returned above&gt;;</code>
<code class="highlighter-rouge">select * from messages where event=events.whatever.whatever.whatever</code></p>

<p><em>another query for events</em>
<code class="highlighter-rouge">select * from messages where body -&gt; 'v1' -&gt;&gt; 'flow_id' = '81';</code>
<code class="highlighter-rouge">select * from messages where body -&gt; 'v1' -&gt;&gt; 'event_guid' = 'bc3a9dc1-ca41-4f2f-aa05-6d4f3e49e696';</code></p>

<h2 id="prometheus">prometheus</h2>
<p><strong>To start the prometheus exporter for phoenix</strong></p>

<p><code class="highlighter-rouge">export SKIP_SERVICE_REGISTRATION=1</code>
<code class="highlighter-rouge">export PROMETHEUS_EXPORTER_PORT=9932</code>
<code class="highlighter-rouge">bundle exec foreman run -e .env,.env_local lfo-prometheus-exporter --name phoenix</code></p>

<h2 id="consul">Consul</h2>
<p>To get the consul ACL master Token look at:
<code class="highlighter-rouge">https://gh.leapfrogonline.net/efisher/ansible-repo/blob/f94eb4d25153f54a0f0db2638407f1e122d57963/inventory/group_vars/consul/consul_vars.yml#L14</code></p>

      <div class="content__nav">
      </div>
      <div class="content__meta">
      </div>
    </main>
    <footer class="footer">
  <div class="footer__container">
    <div class="footer__sections">
      <div class="footer__section">
        <h4 class="footer__section-title"></h4>
        <ul class="footer__link-list">
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
        </ul>
      </div>
      <div class="footer__section">
        <h4 class="footer__section-title"></h4>
        <ul class="footer__link-list">
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
        </ul>
      </div>
      <div class="footer__section">
        <h4 class="footer__section-title"></h4>
        <ul class="footer__link-list">
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
        </ul>
      </div>
    </div>
    <p class="footer__line footer__line--last">Copyright 2019 Joseph Fosco </p>
  </div>
</footer>

  </body>
</html>
