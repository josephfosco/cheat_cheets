.





   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  

   
   
  


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Cheat Sheets</title>
    <link rel="icon" href="./favicon.ico">
    <link rel="stylesheet" href="./css/main.css">
  </head>
  <body class="page">
    <input class="menu-checkbox" id="menu" type="checkbox">
    <header class="header">
      <div class="header__container">
        <label class="header__menu-toggle" for="menu"><span class="hamburger"><span class="hamburger__bar"></span><span class="hamburger__bar"></span><span class="hamburger__bar"></span></span></label>
        <div class="header__logo">
            <a class="header__logo-link" href="./">Cheat Sheets</a>
        </div>
      </div>
    </header>
    <nav class="navigation">
  <div class="navigation__container">
    <label class="navigation__menu-toggle" for="menu"><span class="cross"></span></label>
    <div class="navigation__category">Navigation</div>
    <ul class="navigation__link-list">
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./adsu.html">
            adsu
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./airflow.html">
            airflow
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./aws.html">
            aws
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./emacs.html">
            emacs
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./fox.html">
            fox
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./git.html">
            git
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./i3.html">
            i3
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./iprospect.html">
            iProspect
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./linux.html">
            linux
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./msos.html">
            msos
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./opsbot.html">
            opsbot
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./platform_notes.html">
            Platform Notes
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./postgres.html">
            postgres
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./python.html">
            python
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./tmux.html">
            tmux
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./teams.html">
            Teams
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./vi.html">
            vi
          </a>
        </li>
      
        <li class="navigation__link-list-item">
          <a class="navigation__link-list-link" href="./wordpress.html">
            Wordpress
          </a>
        </li>
      
    </ul>
  </div>
</nav>

    <main class="content">
      <p><strong>split long strings to multiple lines in code</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>long_string = ("this is a very"
               "long string")
               "on three lines in code")
</code></pre></div></div>

<p><strong>To reload a python file in the shell</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import importlib
import &lt;module name&gt; #import the module here, so that it can be reloaded.
importlib.reload(&lt;module name&gt;)
from inputs import A # or whatever name you want.
</code></pre></div></div>

<p><strong>To run tests from one test file</strong></p>

<p>In  psh-comcast change the test command in Makefile to: <br />
<code class="language-plaintext highlighter-rouge">$(HONCHO) run -e .env.test $(COVERAGE) run $(COVERAGE_OPTS) -m unittest discover comcast -k &lt;part_of_test_module_name&gt;</code>
where <code class="language-plaintext highlighter-rouge">&lt;part_of_test_module_name&gt;</code> is any unique part of the filename of the test module you wish to test<br />
To test the module test_modular_offers.py you could write<br />
<code class="language-plaintext highlighter-rouge">-k modular</code></p>

<p><strong>To use a local version of a library</strong>
just put the path to the local library in the requirements file<br />
like celeryutil here (after the comment):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>botocore==1.18.18
boto3&gt;=1.15.0,&lt;1.16
# celeryutil==5.2.0
../celeryutil/dist/celeryutil-6.0.0.tar.gz
cffi==1.14.5
charon==4.0.0
click&gt;=7.1.2,&lt;8.0.0
</code></pre></div></div>

<p><strong>To build a python library</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 -m pip install --upgrade build
python3 -m build
</code></pre></div></div>

<p>The final library file will be in the ‘<strong>dist</strong>’ directory</p>

<p><strong>f-strings</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; name = "Eric"
&gt;&gt;&gt; age = 74
&gt;&gt;&gt; f"Hello, {name}. You are {age}."
'Hello, Eric. You are 74.'
</code></pre></div></div>

<p><strong>Mocking a method on an instance of a class</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">@</span><span class="n">patch</span><span class="p">(</span><span class="s">"objectA"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mobj</span><span class="p">):</span>
    <span class="n">mock_method</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>
    <span class="n">mobj</span><span class="p">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">mock_method</span>
    
    <span class="n">function_to_test</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mobj</span><span class="p">().</span><span class="n">method</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span></code></pre></figure>

<p>It appears that mobj() indicates ANY instance of the class mobj</p>

<p><strong>Mocking an atttribute of a class (like a method)</strong></p>

<p>The following code mocks the write method of the BytesIO object to be
a MagicMock. This means when write is called, the mock will be called
instead, and later it is possible to check what write was called with.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">    <span class="o">@</span><span class="n">mock</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">'mulder.pages.blueprint.BytesIO'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_download_u64encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mbytesio</span><span class="p">):</span>

                <span class="p">.</span>
                <span class="p">.</span>
                <span class="p">.</span>

        <span class="n">mwrite</span><span class="o">=</span><span class="n">MagicMock</span><span class="p">()</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">mbytesio</span><span class="p">.</span><span class="n">return_value</span><span class="p">).</span><span class="n">write</span> <span class="o">=</span> <span class="n">PropertyMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">mwrite</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/_download/things.html'</span><span class="p">)</span>
            <span class="n">mwrite</span><span class="p">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s">'ok'</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span></code></pre></figure>

<p><strong>Python Mocks</strong></p>

<p>Pycon Mock talk<br />
https://www.youtube.com/watch?v=ww1UsGZV8fQ</p>

<p><strong>pyenv installation problems</strong>
If you receive the error
<code class="language-plaintext highlighter-rouge">ERROR: The Python ssl extension was not compiled. Missing the OpenSSL lib?</code>
try
<code class="language-plaintext highlighter-rouge">$sudo dnf install compat-openssl10-devel --allowerasing</code>
then install again. If ths works then return to normal with
<code class="language-plaintext highlighter-rouge">sudo dnf install openssl-devel --allowerasing</code></p>

<p><strong>To run the prometheus exporter for a python.django program</strong>
<code class="language-plaintext highlighter-rouge">env/bin/honcho start -e .env,.env_local psh_comcast_prometheus</code></p>

<p>This is for psh-comcast<br />
“psh_comcast_prometheus” is an entry in the procfile</p>

<p><strong>List all versions of python available in pyenv</strong>
<code class="language-plaintext highlighter-rouge">pyenv install -l</code></p>

<p><strong>Update list of python versions available to pyenv</strong>
<code class="language-plaintext highlighter-rouge">pyenv update</code></p>

<p><strong>Do not bufer log messages</strong></p>

<p>Use PYTHONUNBUFFERED=1 as in<br />
<code class="language-plaintext highlighter-rouge">PYTHONUNBUFFERED=1 make start</code></p>


      <div class="content__nav">
      </div>
      <div class="content__meta">
      </div>
    </main>
    <footer class="footer">
  <div class="footer__container">
    <div class="footer__sections">
      <div class="footer__section">
        <h4 class="footer__section-title"></h4>
        <ul class="footer__link-list">
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
        </ul>
      </div>
      <div class="footer__section">
        <h4 class="footer__section-title"></h4>
        <ul class="footer__link-list">
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
        </ul>
      </div>
      <div class="footer__section">
        <h4 class="footer__section-title"></h4>
        <ul class="footer__link-list">
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
          <li class="footer__link-list-item">
            <a class="footer__link-list-link" ></a>
          </li>
        </ul>
      </div>
    </div>
    <p class="footer__line footer__line--last">Copyright 2019-2022 Joseph Fosco </p>
  </div>
</footer>

  </body>
</html>
